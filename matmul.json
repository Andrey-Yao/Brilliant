{
   "functions":[
      {
         "name":"rand",
         "args":[
            {
               "name":"seq",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "name":"max",
               "type":"int"
            }
         ],
         "instrs":[
            {
               "op":"const",
               "value":25214903917,
               "dest":"a",
               "type":"int"
            },
            {
               "op":"const",
               "value":11,
               "dest":"c",
               "type":"int"
            },
            {
               "op":"const",
               "value":281474976710656,
               "dest":"m",
               "type":"int"
            },
            {
               "op":"load",
               "args":[
                  "seq"
               ],
               "dest":"x",
               "type":"int"
            },
            {
               "op":"mul",
               "args":[
                  "a",
                  "x"
               ],
               "dest":"ax",
               "type":"int"
            },
            {
               "op":"add",
               "args":[
                  "ax",
                  "c"
               ],
               "dest":"axpc",
               "type":"int"
            },
            {
               "op":"div",
               "args":[
                  "axpc",
                  "m"
               ],
               "dest":"next",
               "type":"int"
            },
            {
               "op":"mul",
               "args":[
                  "next",
                  "m"
               ],
               "dest":"next",
               "type":"int"
            },
            {
               "op":"sub",
               "args":[
                  "axpc",
                  "next"
               ],
               "dest":"next",
               "type":"int"
            },
            {
               "op":"load",
               "args":[
                  "seq",
                  "next"
               ]
            },
            {
               "op":"div",
               "args":[
                  "next",
                  "max"
               ],
               "dest":"val",
               "type":"int"
            },
            {
               "op":"mul",
               "args":[
                  "val",
                  "max"
               ],
               "dest":"val",
               "type":"int"
            },
            {
               "op":"sub",
               "args":[
                  "next",
                  "val"
               ],
               "dest":"val",
               "type":"int"
            },
            {
               "op":"ret",
               "args":[
                  "val"
               ]
            }
         ],
         "type":"int"
      },
      {
         "name":"randarray",
         "args":[
            {
               "name":"size",
               "type":"int"
            },
            {
               "name":"rng",
               "type":{
                  "ptr":"int"
               }
            }
         ],
         "instrs":[
            {
               "op":"alloc",
               "args":[
                  "size"
               ],
               "dest":"arr",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"const",
               "value":0,
               "dest":"i",
               "type":"int"
            },
            {
               "op":"const",
               "value":1000,
               "dest":"max",
               "type":"int"
            },
            {
               "op":"const",
               "value":1,
               "dest":"one",
               "type":"int"
            },
            {
               "label":"loop"
            },
            {
               "op":"lt",
               "args":[
                  "i",
                  "size"
               ],
               "dest":"cond",
               "type":"bool"
            },
            {
               "op":"br",
               "args":[
                  "cond"
               ],
               "labels":[
                  "body",
                  "done"
               ]
            },
            {
               "label":"body"
            },
            {
               "op":"call",
               "funcs":[
                  "rand"
               ],
               "args":[
                  "rng",
                  "max"
               ],
               "dest":"val",
               "type":"int"
            },
            {
               "op":"ptradd",
               "args":[
                  "arr",
                  "i"
               ],
               "dest":"loc",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "loc",
                  "val"
               ]
            },
            {
               "label":"loop_end"
            },
            {
               "op":"add",
               "args":[
                  "i",
                  "one"
               ],
               "dest":"i",
               "type":"int"
            },
            {
               "op":"jmp",
               "labels":[
                  "loop"
               ]
            },
            {
               "label":"done"
            },
            {
               "op":"ret",
               "args":[
                  "arr"
               ]
            }
         ],
         "type":{
            "ptr":"int"
         }
      },
      {
         "name":"printarray",
         "args":[
            {
               "name":"size",
               "type":"int"
            },
            {
               "name":"arr",
               "type":{
                  "ptr":"int"
               }
            }
         ],
         "instrs":[
            {
               "op":"const",
               "value":0,
               "dest":"i",
               "type":"int"
            },
            {
               "op":"const",
               "value":1,
               "dest":"one",
               "type":"int"
            },
            {
               "label":"loop"
            },
            {
               "op":"lt",
               "args":[
                  "i",
                  "size"
               ],
               "dest":"cond",
               "type":"bool"
            },
            {
               "op":"br",
               "args":[
                  "cond"
               ],
               "labels":[
                  "body",
                  "done"
               ]
            },
            {
               "label":"body"
            },
            {
               "op":"ptradd",
               "args":[
                  "arr",
                  "i"
               ],
               "dest":"loc",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "loc"
               ],
               "dest":"val",
               "type":"int"
            },
            {
               "op":"print",
               "args":[
                  "val"
               ]
            },
            {
               "label":"loop_end"
            },
            {
               "op":"add",
               "args":[
                  "i",
                  "one"
               ],
               "dest":"i",
               "type":"int"
            },
            {
               "op":"jmp",
               "labels":[
                  "loop"
               ]
            },
            {
               "label":"done"
            },
            {
               "op":"ret",
               "args":null
            }
         ]
      },
      {
         "name":"matmul",
         "args":[
            {
               "name":"size",
               "type":"int"
            },
            {
               "name":"arr1",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "name":"arr2",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "name":"dest",
               "type":{
                  "ptr":"int"
               }
            }
         ],
         "instrs":[
            {
               "op":"const",
               "value":1,
               "dest":"one",
               "type":"int"
            },
            {
               "op":"const",
               "value":0,
               "dest":"row",
               "type":"int"
            },
            {
               "label":"row.loop"
            },
            {
               "op":"lt",
               "args":[
                  "row",
                  "size"
               ],
               "dest":"cond",
               "type":"bool"
            },
            {
               "op":"br",
               "args":[
                  "cond"
               ],
               "labels":[
                  "row.body",
                  "row.done"
               ]
            },
            {
               "label":"row.body"
            },
            {
               "op":"const",
               "value":0,
               "dest":"col",
               "type":"int"
            },
            {
               "label":"col.loop"
            },
            {
               "op":"lt",
               "args":[
                  "col",
                  "size"
               ],
               "dest":"cond",
               "type":"bool"
            },
            {
               "op":"br",
               "args":[
                  "cond"
               ],
               "labels":[
                  "col.body",
                  "col.done"
               ]
            },
            {
               "label":"col.body"
            },
            {
               "op":"const",
               "value":0,
               "dest":"sum",
               "type":"int"
            },
            {
               "op":"const",
               "value":0,
               "dest":"i",
               "type":"int"
            },
            {
               "label":"sum.loop"
            },
            {
               "op":"lt",
               "args":[
                  "i",
                  "size"
               ],
               "dest":"cond",
               "type":"bool"
            },
            {
               "op":"br",
               "args":[
                  "cond"
               ],
               "labels":[
                  "sum.body",
                  "sum.done"
               ]
            },
            {
               "label":"sum.body"
            },
            {
               "op":"mul",
               "args":[
                  "row",
                  "size"
               ],
               "dest":"lidx",
               "type":"int"
            },
            {
               "op":"add",
               "args":[
                  "lidx",
                  "i"
               ],
               "dest":"lidx",
               "type":"int"
            },
            {
               "op":"mul",
               "args":[
                  "i",
                  "size"
               ],
               "dest":"ridx",
               "type":"int"
            },
            {
               "op":"add",
               "args":[
                  "ridx",
                  "col"
               ],
               "dest":"ridx",
               "type":"int"
            },
            {
               "op":"ptradd",
               "args":[
                  "arr1",
                  "lidx"
               ],
               "dest":"lvalloc",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "lvalloc"
               ],
               "dest":"lval",
               "type":"int"
            },
            {
               "op":"ptradd",
               "args":[
                  "arr2",
                  "ridx"
               ],
               "dest":"rvalloc",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "rvalloc"
               ],
               "dest":"rval",
               "type":"int"
            },
            {
               "op":"mul",
               "args":[
                  "lval",
                  "rval"
               ],
               "dest":"prod",
               "type":"int"
            },
            {
               "op":"add",
               "args":[
                  "sum",
                  "prod"
               ],
               "dest":"sum",
               "type":"int"
            },
            {
               "label":"sum.loop_end"
            },
            {
               "op":"add",
               "args":[
                  "i",
                  "one"
               ],
               "dest":"i",
               "type":"int"
            },
            {
               "op":"jmp",
               "labels":[
                  "sum.loop"
               ]
            },
            {
               "label":"sum.done"
            },
            {
               "op":"mul",
               "args":[
                  "row",
                  "size"
               ],
               "dest":"idx",
               "type":"int"
            },
            {
               "op":"add",
               "args":[
                  "idx",
                  "col"
               ],
               "dest":"idx",
               "type":"int"
            },
            {
               "op":"ptradd",
               "args":[
                  "dest",
                  "idx"
               ],
               "dest":"loc",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "loc",
                  "sum"
               ]
            },
            {
               "label":"col.loop_end"
            },
            {
               "op":"add",
               "args":[
                  "col",
                  "one"
               ],
               "dest":"col",
               "type":"int"
            },
            {
               "op":"jmp",
               "labels":[
                  "col.loop"
               ]
            },
            {
               "label":"col.done"
            },
            {
               "label":"row.loop_end"
            },
            {
               "op":"add",
               "args":[
                  "row",
                  "one"
               ],
               "dest":"row",
               "type":"int"
            },
            {
               "op":"jmp",
               "labels":[
                  "row.loop"
               ]
            },
            {
               "label":"row.done"
            },
            {
               "op":"ret",
               "args":null
            }
         ]
      },
      {
         "name":"main",
         "args":[
            {
               "name":"size",
               "type":"int"
            },
            {
               "name":"seed",
               "type":"int"
            }
         ],
         "instrs":[
            {
               "op":"const",
               "value":1,
               "dest":"one",
               "type":"int"
            },
            {
               "op":"alloc",
               "args":[
                  "one"
               ],
               "dest":"rng",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"load",
               "args":[
                  "rng",
                  "seed"
               ]
            },
            {
               "op":"mul",
               "args":[
                  "size",
                  "size"
               ],
               "dest":"sqsize",
               "type":"int"
            },
            {
               "op":"call",
               "funcs":[
                  "randarray"
               ],
               "args":[
                  "sqsize",
                  "rng"
               ],
               "dest":"arr1",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"call",
               "funcs":[
                  "randarray"
               ],
               "args":[
                  "sqsize",
                  "rng"
               ],
               "dest":"arr2",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"call",
               "funcs":[
                  "randarray"
               ],
               "args":[
                  "sqsize",
                  "rng"
               ],
               "dest":"dest",
               "type":{
                  "ptr":"int"
               }
            },
            {
               "op":"call",
               "funcs":[
                  "matmul"
               ],
               "args":[
                  "size",
                  "arr1",
                  "arr2",
                  "dest"
               ]
            },
            {
               "op":"call",
               "funcs":[
                  "printarray"
               ],
               "args":[
                  "sqsize",
                  "arr1"
               ]
            },
            {
               "op":"call",
               "funcs":[
                  "printarray"
               ],
               "args":[
                  "sqsize",
                  "arr2"
               ]
            },
            {
               "op":"call",
               "funcs":[
                  "printarray"
               ],
               "args":[
                  "sqsize",
                  "dest"
               ]
            },
            {
               "op":"free",
               "args":[
                  "arr1"
               ]
            },
            {
               "op":"free",
               "args":[
                  "arr2"
               ]
            },
            {
               "op":"free",
               "args":[
                  "dest"
               ]
            },
            {
               "op":"free",
               "args":[
                  "rng"
               ]
            },
            {
               "op":"ret",
               "args":null
            }
         ]
      }
   ]
}
